# vv-receipts
Анализ расходов на продукты на основе чеков ВкусВилл <br></br>
Арзитектура пайплайна:
```
  A[Gmail Inbox] --> B[Google Apps Script: Email Parser]
  B --> C[Google Sheet: Raw Emails]
  C --> D[Python Script: Regex Parser]
  D --> E[Clean DataFrame]
  E --> F[Excel Manual Categorization]
  F --> G[Final Table: Ready for Analysis]
```

1. Gmail-парсинг (Google Apps Script)

- Скрипт `get_emails.gs` ищет письма от ВкусВилла и сохраняет их тело, тему, дату и другие данные в Google Таблицу.

Функции:

- getGmailEmails() — поиск писем по фильтру

- extractDetails() — парсинг содержимого письма и запись в таблицу

- onOpen() — добавление кнопки в интерфейс Google Таблиц

2. Обработка данных (Python)

* Скрипт на Python `vv_parser.py` подключается к Google Таблице, извлекает тело писем и обрабатывает его с помощью регулярных выражений для извлечения:

- Названия товара

- Количества

- Цены за единицу

- Итоговой суммы

Используются два основных паттерна (numeric_pattern и item_pattern), которые покрывают разные форматы чеков.

3. Категоризация товаров

* После парсинга итоговый DataFrame экспортируется в Excel. Вручную добавляются две колонки:

- category — основная категория продукта

- subcategory — подкатегория

Этот шаг выполняется один раз. Обновления нужны только при появлении новых товаров.

4. Финальная таблица

Итоговый DataFrame содержит такие поля:

- date

- product

- quantity

- price

- total_sum

- short_date

- category

- subcategory

Пример готовой таблицы:
| date             | product                                                                 |   quantity |   price |   total_sum | short_date   | category   | subcategory             |
|:-----------------|:------------------------------------------------------------------------|-----------:|--------:|------------:|:-------------|:-----------|:------------------------|
| 2025-05-28 12:42 | сосиски куриные "суперсила", 600 г                                      |       1    |   453.6 |      453.6  | 2025-05-22   | food       | meat and sausages       |
| 2025-05-28 12:42 | брокколи                                                                |       0.45 |   410   |      184.5  | 2025-05-17   | food       | veggies                 |
| 2025-05-28 12:42 | бананы                                                                  |       0.93 |   178   |      164.65 | 2025-05-17   | food       | fruits                  |
| 2025-05-28 12:42 | печенье протеиновое bombbar низкокалорийное шоколадный брауни 40 г      |       2    |   109   |      218    | 2025-05-17   | food       | sweets                  |
| 2025-05-28 12:42 | кофе молотый lavazza crema e gusto 250 г                                |       4    |   649   |     2596    | 2025-05-17   | beverages  | coffee and tea          |
| 2025-05-28 12:42 | пакет-майка "вкусвилл" малый                                            |       1    |     8   |        8    | 2025-05-17   | food       | packages                |
| 2025-05-19 19:11 | бананы                                                                  |       1    |   178   |      178    | 2025-05-17   | food       | fruits                  |
| 2025-05-19 19:11 | высокопротеиновый пудинг hyper high protein со вкусом ванили 1,5% 200 г |       2    |   155   |      310    | 2025-05-17   | food       | milk and dairy products |
| 2025-05-19 19:11 | голубика, 125 г                                                         |       1    |   240   |      240    | 2025-05-17   | food       | berries                 |
| 2025-05-19 19:11 | хлеб "на кефире с сывороткой", нарезка                                  |       1    |    87   |       87    | 2025-05-17   | food       | bread                   |

Вот исходный формат данных:
``` 
 Кассовый чек 3329,61 ₽ от «АКЦИОНЕРНОЕ ОБЩЕСТВО "ВКУСВИЛЛ"» Помогаем 
продавать 
 ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌  
  
<https://ofd.ru/> 
Помогаем 
продавать 
  Скачать 
<https://ofd.ru/Document/RenderDoc?RawId=bd202183-cb70-5d6a-65a3-8a920d18b1e7&format=pdf> 

   
*Кассовый чек / Приход* 
АКЦИОНЕРНОЕ ОБЩЕСТВО "ВКУСВИЛЛ" 
ФИСКАЛЬНЫЙ ДОКУМЕНТ 
#72453 
ДАТА ВЫДАЧИ 
17.05.25 19:37 
АДРЕС РАСЧЁТОВ 
г. Москва, Остаповский проезд, д.22, стр.16 
МЕСТО РАСЧЁТОВ 
www.vkusvill.ru 
КАССИР 
Кассир 
НОМЕР СМЕНЫ 
#68 
ДОКУМЕНТ В СМЕНЕ 
#81 
ЭЛ. АДР. ПОКУПАТЕЛЯ 
prolapsha@gmail.com 
ВЕРСИЯ ФФД 
1.2 
Признак ККТ для расчетов только в Интернет 
Да 
Адрес электронной почты отправителя чека 
noreply@ofd.ru 
Адрес сайта ФНС 
nalog.gov.ru 
РН 0007716314023899 
ИНН 7734443270 
ФН 7384440800478513 
ФПД 980818482 
ОФД 
ООО ПС СТ 
Адрес проверки чека в ОФД 
check.ofd.ru 
*Капуста квашеная с морковью* 
1 X 136.00 
в т.ч. СУММА НДС 20% = 22.67 
= 136.00 
ПРИЗНАК СПОСОБА РАСЧЕТА 
ПОЛНЫЙ РАСЧЕТ 
ПРИЗНАК ПРЕДМЕТА РАСЧЕТА 
ТОВАР 
Размер НДС за единицу предмета расчета 
22.67 
Мера кол-ва предмета расчета 
шт. 
*Молоко сгущенное Алексеевское цельное 8,5% 270 г* 
1 X 135.00 
в т.ч. СУММА НДС 10% = 12.27 
= 135.00 
ПРИЗНАК СПОСОБА РАСЧЕТА 
ПОЛНЫЙ РАСЧЕТ 
ПРИЗНАК ПРЕДМЕТА РАСЧЕТА 
ТОВАР 
Размер НДС за единицу предмета расчета 
12.27 
Код товара 
046071094709925G9u3x 
Результат проверки сведений о товаре 
[M+] 
Мера кол-ва предмета расчета 
шт. 
*Сосиски куриные 'Суперсила', 600 г* 
1 X 454.00 
в т.ч. СУММА НДС 10% = 41.27 
= 454.00 
ПРИЗНАК СПОСОБА РАСЧЕТА 
ПОЛНЫЙ РАСЧЕТ 
ПРИЗНАК ПРЕДМЕТА РАСЧЕТА 
ТОВАР 
Размер НДС за единицу предмета расчета 
41.27 
Мера кол-ва предмета расчета 
шт. 
*Сок яблочный осветлённый, 1 л, тетра пак* 
1 X 173.00 
в т.ч. СУММА НДС 10% = 15.73 
= 173.00 
ПРИЗНАК СПОСОБА РАСЧЕТА 
ПОЛНЫЙ РАСЧЕТ 
ПРИЗНАК ПРЕДМЕТА РАСЧЕТА 
ТОВАР 
Размер НДС за единицу предмета расчета 
15.73 
Код товара 
0104601248027598215LHQRD<)TiSCE■ 
Результат проверки сведений о товаре 
[M] 
Мера кол-ва предмета расчета 
шт. 
*Лук зеленый, 50 г* 
1 X 73.00 
в т.ч. СУММА НДС 10% = 6.64 
= 73.00 
ПРИЗНАК СПОСОБА РАСЧЕТА 
ПОЛНЫЙ РАСЧЕТ 
ПРИЗНАК ПРЕДМЕТА РАСЧЕТА 
ТОВАР 
Размер НДС за единицу предмета расчета 
6.64 
Мера кол-ва предмета расчета 
шт. 
*Молоко безлактозное ультрапастеризованное 1,5%, 970 мл* 
1 X 162.00 
в т.ч. СУММА НДС 10% = 14.73 
= 162.00 
ПРИЗНАК СПОСОБА РАСЧЕТА 
ПОЛНЫЙ РАСЧЕТ 
ПРИЗНАК ПРЕДМЕТА РАСЧЕТА 
ТОВАР 
Размер НДС за единицу предмета расчета 
14.73 
Код товара 
046100300338845vKfRD 
Результат проверки сведений о товаре 
[M+] 
Мера кол-ва предмета расчета 
шт. 
*Лук красный, 500 г* 
1 X 102.00 
в т.ч. СУММА НДС 10% = 9.27 
= 102.00 
ПРИЗНАК СПОСОБА РАСЧЕТА 
ПОЛНЫЙ РАСЧЕТ 
ПРИЗНАК ПРЕДМЕТА РАСЧЕТА 
ТОВАР 
Размер НДС за единицу предмета расчета 
9.27 
Мера кол-ва предмета расчета 
шт. 
*Творог 9%, 180 г* 
1 X 118.00 
в т.ч. СУММА НДС 10% = 10.73 
= 118.00 
ПРИЗНАК СПОСОБА РАСЧЕТА 
ПОЛНЫЙ РАСЧЕТ 
ПРИЗНАК ПРЕДМЕТА РАСЧЕТА 
ТОВАР 
Размер НДС за единицу предмета расчета 
10.73 
Код товара 
046100300334715!-T,Z 
Результат проверки сведений о товаре 
[M+] 
Мера кол-ва предмета расчета 
шт. 
*Авокадо Хасс, 2 шт* 
1 X 270.00 
в т.ч. СУММА НДС 10% = 24.55 
= 270.00 
ПРИЗНАК СПОСОБА РАСЧЕТА 
ПОЛНЫЙ РАСЧЕТ 
ПРИЗНАК ПРЕДМЕТА РАСЧЕТА 
ТОВАР 
Размер НДС за единицу предмета расчета 
24.55 
Мера кол-ва предмета расчета 
шт. 
*Сыр 'Российский', 200 г* 
1 X 270.00 
в т.ч. СУММА НДС 10% = 24.55 
= 270.00 
ПРИЗНАК СПОСОБА РАСЧЕТА 
ПОЛНЫЙ РАСЧЕТ 
ПРИЗНАК ПРЕДМЕТА РАСЧЕТА 
ТОВАР 
Размер НДС за единицу предмета расчета 
24.55 
Код товара 
046202197410595WAYLe 
Результат проверки сведений о товаре 
[M+] 
Мера кол-ва предмета расчета 
шт. 
*Творог 9%, 180 г* 
1 X 118.00 
в т.ч. СУММА НДС 10% = 10.73 
= 118.00 
ПРИЗНАК СПОСОБА РАСЧЕТА 
ПОЛНЫЙ РАСЧЕТ 
ПРИЗНАК ПРЕДМЕТА РАСЧЕТА 
ТОВАР 
Размер НДС за единицу предмета расчета 
10.73 
Код товара 
046100300334715!temj 
Результат проверки сведений о товаре 
[M+] 
Мера кол-ва предмета расчета 
шт. 
*Пакет-майка 'ВкусВилл' малый* 
2 X 8.00 
в т.ч. СУММА НДС 20% = 2.67 
= 16.00 
ПРИЗНАК СПОСОБА РАСЧЕТА 
ПОЛНЫЙ РАСЧЕТ 
ПРИЗНАК ПРЕДМЕТА РАСЧЕТА 
ТОВАР 
Размер НДС за единицу предмета расчета 
1.33 
Мера кол-ва предмета расчета 
шт. 
*Корнишоны маринованные 'По-домашнему', 370 г* 
1 X 190.00 
в т.ч. СУММА НДС 20% = 31.67 
= 190.00 
ПРИЗНАК СПОСОБА РАСЧЕТА 
ПОЛНЫЙ РАСЧЕТ 
ПРИЗНАК ПРЕДМЕТА РАСЧЕТА 
ТОВАР 
Размер НДС за единицу предмета расчета 
31.67 
Мера кол-ва предмета расчета 
шт. 
*Бананы* 
1,015 X 178.00 
в т.ч. СУММА НДС 20% = 30.11 
= 180.67 
ПРИЗНАК СПОСОБА РАСЧЕТА 
ПОЛНЫЙ РАСЧЕТ 
ПРИЗНАК ПРЕДМЕТА РАСЧЕТА 
ТОВАР 
Размер НДС за единицу предмета расчета 
29.67 
Мера кол-ва предмета расчета 
кг 
*Бедро цыпленка-бройлера бескостное (филе бедра)* 
1,508 X 618.00 
в т.ч. СУММА НДС 10% = 84.72 
= 931.94 
ПРИЗНАК СПОСОБА РАСЧЕТА 
ПОЛНЫЙ РАСЧЕТ 
ПРИЗНАК ПРЕДМЕТА РАСЧЕТА 
ТОВАР 
Размер НДС за единицу предмета расчета 
56.18 
Мера кол-ва предмета расчета 
кг 
ИТОГ 
3329.61 
ПРЕДВАРИТЕЛЬНАЯ ОПЛАТА (АВАНС) 
3329.61 
Сумма по чеку (БСО) встречным предоставлением 
0.00 
Наличными 
0.00 
Безналичными 
0.00 
  в т.ч. налоги 
  СУММА НДС 10% 
255.19 
  СУММА НДС 20% 
87.12 
Система налогообложения 
ОСН 
   
  
Открыть чек <https://ofd.ru/b/bd202183cb705d6a65a38a920d18b1e7> 

 
 
Вы получили этот чек, так как указали свои контактные данные при покупке 
в интернете у «АКЦИОНЕРНОЕ ОБЩЕСТВО "ВКУСВИЛЛ"» или попросили кассира 
отправить электронный чек. Если вы не указывали свои данные — 
проигнорируйте это письмо. Оно вас ни к чему не обязывает. Если есть 
вопросы о покупке, свяжитесь с «АКЦИОНЕРНОЕ ОБЩЕСТВО "ВКУСВИЛЛ"». Реквизиты 
указаны в чеке. 
 
Почему мы отправили вам чек? Мы OFD.ru <https://ofd.ru> выполняем 
требования, которые описаны в статье 4.5 пункте 5 54-ФЗ и обязаны 
направлять покупателю чек в электронном формате при расчетах в интернете 
или по требованию покупателя. 
 
<https://vk.com/ofdruedoru> <https://ok.ru/ofdru> <https://t.me/ofd_ru> 
<https://www.youtube.com/c/OFDru> 

 
Отправка чека с помощью OFD.ru <https://ofd.ru> 
 
------------------------------
```
